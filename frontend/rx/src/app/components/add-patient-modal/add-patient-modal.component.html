<ion-header>
  <ion-toolbar color="primary">
    <ion-title>{{isEditing ? 'Edit Patient' : 'Add New Patient'}}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="dismiss()">
        <ion-icon name="close-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form [formGroup]="patientForm" (ngSubmit)="submit()">
    <ion-grid>
      <ion-row>
        <ion-col size="12">
          <ion-item lines="full" class="form-item">
            <ion-label position="floating">Full Name *</ion-label>
            <ion-input 
              type="text" 
              formControlName="full_name"
              placeholder="Enter patient's full name">
            </ion-input>
            <ion-icon name="person-outline" slot="start"></ion-icon>
            <ion-note slot="error" *ngIf="patientForm.get('full_name')?.touched && patientForm.get('full_name')?.errors">
              Name is required
            </ion-note>
          </ion-item>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="12" size-md="6">
          <ion-item lines="full" class="form-item">
            <ion-label position="floating">Age *</ion-label>
            <ion-input 
              type="number" 
              formControlName="age"
              placeholder="Age in years">
            </ion-input>
            <ion-icon name="calendar-outline" slot="start"></ion-icon>
            <ion-note slot="error" *ngIf="patientForm.get('age')?.touched && patientForm.get('age')?.errors">
              Please enter a valid age (0-150)
            </ion-note>
          </ion-item>
        </ion-col>

        <ion-col size="12" size-md="6">
          <ion-item lines="full" class="form-item">
            <ion-label>Sex *</ion-label>
            <ion-select 
              formControlName="sex"
              interface="action-sheet">
              <ion-select-option value="">Select</ion-select-option>
              <ion-select-option value="male">Male</ion-select-option>
              <ion-select-option value="female">Female</ion-select-option>
              <ion-select-option value="other">Other</ion-select-option>
            </ion-select>
            <ion-icon name="transgender-outline" slot="start"></ion-icon>
          </ion-item>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="12" size-md="6">
          <ion-item lines="full" class="form-item">
            <ion-label position="floating">Mobile Number</ion-label>
            <ion-input 
              type="tel" 
              formControlName="mobile"
              placeholder="Mobile number (optional)">
            </ion-input>
            <ion-icon name="call-outline" slot="start"></ion-icon>
          </ion-item>
        </ion-col>

        <ion-col size="12" size-md="6">
          <ion-item lines="full" class="form-item">
            <ion-label position="floating">Email</ion-label>
            <ion-input 
              type="email" 
              formControlName="email"
              placeholder="Email address (optional)">
            </ion-input>
            <ion-icon name="mail-outline" slot="start"></ion-icon>
          </ion-item>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="12">
          <ion-item lines="full" class="form-item">
            <ion-label position="floating">Address</ion-label>
            <ion-textarea 
              formControlName="address"
              placeholder="Complete address (optional)"
              rows="2">
            </ion-textarea>
            <ion-icon name="location-outline" slot="start"></ion-icon>
          </ion-item>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="12" size-md="6">
          <ion-item lines="full" class="form-item">
            <ion-label>Blood Group</ion-label>
            <ion-select 
              formControlName="blood_group"
              interface="action-sheet">
              <ion-select-option value="">Select</ion-select-option>
              <ion-select-option value="A+">A+</ion-select-option>
              <ion-select-option value="A-">A-</ion-select-option>
              <ion-select-option value="B+">B+</ion-select-option>
              <ion-select-option value="B-">B-</ion-select-option>
              <ion-select-option value="O+">O+</ion-select-option>
              <ion-select-option value="O-">O-</ion-select-option>
              <ion-select-option value="AB+">AB+</ion-select-option>
              <ion-select-option value="AB-">AB-</ion-select-option>
            </ion-select>
            <ion-icon name="water-outline" slot="start"></ion-icon>
          </ion-item>
        </ion-col>

        <ion-col size="12" size-md="6">
          <ion-item lines="full" class="form-item">
            <ion-label position="floating">Allergies</ion-label>
            <ion-input 
              type="text" 
              formControlName="allergies"
              placeholder="List of allergies (optional)">
            </ion-input>
            <ion-icon name="warning-outline" slot="start"></ion-icon>
          </ion-item>
        </ion-col>
      </ion-row>
    </ion-grid>

    <div class="modal-actions">
      <ion-button 
        expand="block" 
        type="submit" 
        color="primary"
        [disabled]="patientForm.invalid || isLoading">
        <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>
        <span *ngIf="!isLoading">{{isEditing ? 'Update' : 'Add'}} Patient</span>
      </ion-button>
      
      <ion-button 
        expand="block" 
        fill="clear" 
        color="medium"
        (click)="dismiss()"
        [disabled]="isLoading">
        Cancel
      </ion-button>
    </div>
  </form>
</ion-content>